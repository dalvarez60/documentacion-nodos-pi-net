## 4. Implementación del Nodo de Pi Network (Método Directo con Docker)
Con tu VPS completamente preparado (actualizado, Docker instalado y firewall configurado), el siguiente paso es desplegar el software del nodo de Pi Network utilizando comandos directos de Docker. Este método es el recomendado actualmente para nodos en servidores sin interfaz gráfica (headless), asegurando que utilizas las imágenes más recientes y gestionas los contenedores de forma explícita.

## 4.1. Crear Volúmenes de Datos para el Nodo Pi
Estos volúmenes de Docker son esenciales para almacenar los datos de la blockchain de forma persistente. Esto significa que si necesitas actualizar o recrear el contenedor del nodo, tus datos de sincronización no se perderán. Crearemos dos volúmenes: uno para los datos específicos del nodo Pi y otro para los datos de Stellar Core (el protocolo subyacente de la blockchain de Pi).

Instrucción para Ejecutar: Copia los siguientes comandos (uno por uno), pégalos en tu terminal SSH, y presiona Enter.

```bash
docker volume create pi-node-data
```
Este comando crea un volumen de Docker llamado pi-node-data que se usará para almacenar los datos específicos de tu nodo Pi.

```bash
docker volume create stellar-core-data
```
Este comando crea un volumen de Docker llamado stellar-core-data para almacenar los datos de la sincronización de la blockchain de Stellar Core.

## 4.2. Obtener la Imagen de Docker del Nodo Pi (Backend)
La imagen principal del nodo de Pi se llama pinetwork/pi-node-backend. Esta imagen es la que orquesta los demás componentes, incluido el Stellar Core. La descargaremos de Docker Hub.

Instrucción para Ejecutar: Copia el siguiente comando, pégalo en tu terminal SSH, y presiona Enter.

```bash
docker pull pinetwork/pi-node-backend:latest
```
Este comando descarga la última versión (latest) de la imagen oficial del backend del nodo de Pi Network desde Docker Hub. Este proceso puede tardar unos minutos dependiendo de tu conexión a internet.

## 4.3. Preparación para Ejecución Persistente (Usando screen - RECOMENDADO)
Dado que la sincronización de la blockchain puede durar horas o incluso días, es altamente recomendable ejecutar el comando de inicio del contenedor dentro de una sesión de screen. Esto te permitirá desconectarte de tu sesión SSH sin que el proceso se detenga en el servidor.

## 4.3.1. Instalar screen
Primero, instala screen si aún no está en tu VPS.

Instrucción para Ejecutar: Copia el siguiente comando, pégalo en tu terminal SSH, y presiona Enter.

```bash
sudo apt install screen -y
```

## 4.3.2. Iniciar una Sesión de screen
Ahora, inicia una nueva sesión de screen. Esto creará una nueva "ventana" de terminal dentro de tu VPS.

Instrucción para Ejecutar: Copia el siguiente comando, pégalo en tu terminal SSH, y presiona Enter.

```bash
screen -S pi_node_install
```
El flag -S pi_node_install le da un nombre a tu sesión (pi_node_install), lo que facilita identificarla si tienes múltiples sesiones de screen abiertas.

Verás que tu terminal se limpiará, dándote una nueva línea de comandos. Esto indica que estás dentro de la sesión de screen.

## 4.4. Ejecutar el Contenedor del Nodo Pi (¡Dentro de screen!)
Ahora que estás dentro de la sesión de screen, puedes ejecutar el comando docker run para iniciar y configurar el contenedor del nodo. Si tu conexión SSH se cae, el contenedor seguirá ejecutándose sin problemas en la sesión de screen en el servidor.

Instrucción para Ejecutar (¡dentro de tu sesión de screen!): Copia todo el bloque de comando siguiente (es una sola línea larga), pégalo en tu terminal SSH (que está dentro de tu sesión de screen), y presiona Enter.

```bash
docker run -d --restart unless-stopped --name pi-node-backend \
  -p 31400:31400 \
  -p 31401:31401 \
  -p 31402:31402 \
  -p 31403:31403 \
  -p 31404:31404 \
  -p 31405:31405 \
  -p 31406:31406 \
  -p 31407:31407 \
  -p 31408:31408 \
  -p 31409:31409 \
  -v pi-node-data:/pi-node-data \
  -v stellar-core-data:/stellar-core-data \
  pinetwork/pi-node-backend:latest
```
-d: Ejecuta el contenedor en modo detached (en segundo plano).
--restart unless-stopped: Configura el contenedor para que se reinicie automáticamente si el VPS se apaga o se reinicia.
--name pi-node-backend: Asigna un nombre al contenedor.
-p ...: Mapea los puertos externos de tu VPS a los puertos internos del contenedor.
-v ...: Adjunta los volúmenes de datos que creaste.
pinetwork/pi-node-backend:latest: Especifica la imagen de Docker a utilizar.

Si el comando se ejecuta con éxito, verás una larga cadena de caracteres (el ID del contenedor) y el prompt de tu terminal volverá a aparecer. ¡Esto significa que el contenedor ha iniciado!

## 4.4.1. Cómo Desconectarse (Detach) de la Sesión de screen
Una vez que el contenedor esté ejecutándose (o si necesitas desconectarte en cualquier momento), puedes "desengancharte" de la sesión de screen sin detener el contenedor en curso.

Combinación de Teclas:

1- Presiona Ctrl + A (mantén Ctrl presionado y luego presiona A).
2- Suelta Ctrl + A y luego presiona d (la letra 'd').

Verás un mensaje como [detached from ...] y volverás a tu terminal SSH normal. Tu contenedor de Docker seguirá ejecutándose en segundo plano dentro del screen y el VPS.

## 4.4.2. Cómo Volver a Conectarse (Re-attach) a la Sesión de screen
Si te has desconectado y quieres volver a ver la sesión de screen donde iniciaste el contenedor (por ejemplo, para ver los logs en tiempo real o por si el docker run no te mostró todo), puedes reconectarte.

Abre una nueva sesión de Git Bash y conéctate a tu VPS vía SSH nuevamente (ssh tu_usuario@tu_ip_vps).

Una vez dentro del VPS, usa el siguiente comando:

```bash
screen -r pi_node_install
```
Si solo tienes una sesión de screen abierta, puedes usar screen -r (sin el nombre).

Si tienes múltiples sesiones y no recuerdas el nombre, puedes listarlas con:

```bash
screen -ls
```
Y luego reconectarte usando el ID o el nombre de la sesión: screen -r <ID_o_Nombre>.

## 4.5. Verificar el Estado y la Sincronización del Nodo
Una vez que el contenedor ha iniciado, es fundamental verificar su estado y monitorear el progreso de la sincronización de la blockchain. Recuerda que la sincronización inicial de Stellar Core puede llevar horas o incluso días.

## 4.5.1. Verificar Contenedores en Ejecución
```bash
docker ps
```
Este comando lista todos los contenedores de Docker que están actualmente en ejecución. Deberías ver un contenedor con el nombre pi-node-backend en la lista, y su estado debería ser Up.

## 4.5.2. Monitorear los Registros (Logs) del Nodo
Para ver lo que está haciendo tu nodo y verificar el progreso de la sincronización de Stellar Core, puedes ver los logs del contenedor.

```bash
docker logs -f pi-node-backend
```
docker logs: Muestra los registros (logs) del contenedor especificado.
-f: Permanece "siguiendo" los logs, lo que significa que verás los nuevos mensajes en tiempo real a medida que el nodo los genera (como el tail -f en Linux).
pi-node-backend: Es el nombre de tu contenedor.
Qué Buscar en los Logs:

Verás mensajes relacionados con el inicio de los servicios de Pi Node y Stellar Core.
Busca mensajes que indiquen la sincronización de Stellar Core, como "catching up", "synching", "ledger closed" o números de "ledger" incrementando rápidamente.
Si ves errores repetidos o el contenedor se detiene, consulta la sección de resolución de problemas.
Para salir de la visualización de los logs, presiona Ctrl + C.

[Volver al Menú Principal](Index.md)

